# BWS (Bibi Web Service) PaaS サービスの設計(と実装)

詳細なフローと対応する内部動作
- [ユーザからみたサービス](flow-user-app.md)
- [コントロールパネル(管理画面)](flow-control-panel.md)

図(上): ユーザアプリの動作
(コンテナ,プロトコル,裏側ネットワーク,ストレージ)
<img src=images/bws-paas-userapp.png       width=640px>

図(中): コントロールパネルの動作
(コンテナ,プロトコル,裏側ネットワーク,ストレージ)
(注: 裏側のスクリプト部は省略)
<img src=images/bws-paas-control-panel.png width=640px>

図(下): コントロールパネルの動作(詳細)
<img src=images/bws-paas_wholesight.png    width=640px>



## BWSという名称について

"A"WSのニセ物だから"B"WSではなく、Bibi Web Service です(と言い張ってみる:-)

あと AWS side-B という意味合いで、BWS なんすよ
(昭和?
まぁレコードのA面B面が分からないと、なにがB面?とか、
かつて「NHK ソリトン Side-B」というサブカル番組があってだな〜とか、
いろいろ分からないよね;-)


## BWSの対象者

- 大学在籍者であれば希望者全員
- 「〜のオンライン講習会」などといった目的があれば学外も可
- 授業で使いたいもOK
    - (後期ではなく前期の)ソフトウエア工学概論で使う要望が出てきました(!)


## ビジネス的な観点: 作成のコストと優先度を考えてみようや

- 上の条件から、いいところ年に100ユーザくらいしか作成しないでしょうという見つもり
- つねに使っているアクティブユーザ数は、さらに少なく、2,30とかではないだろうか?
- とりあえずコントロールパネルは、あるサーバで動いています。当面そういう仮定
    - このコンパネさん、冗長構成を考えるほど忙しくないだろうと思ってさ
- 作成のコストと優先度を考えておくれ
    - そう思うと、ユーザ作成などの管理画面などに割くコストが必要か?
        - ここから、ユーザの作成くらい手動でもいいよね?という発想へ
        - 余裕があれば作ってください
    - 10,000ユーザとかいるなら RDBMS 使うことを考えれば?と言いますけどもね
    - 少ないユーザ数で、管理情報も多くないから、
      KEY-VALUEストア(いわゆる生のデータベースエンジン)で十分でしょうと
        - 管理情報
            - (USER_ID とパスワードの組 (最初のうちは,PaaSのシステム外で保守します)
            - キー:USER_ID             => 値: APP_ID
            - キー:USER_ID-APP_ID-日付 => 値:カウンタ(日付が変わったら捨ててOK:-)
    - 管理情報の保存をするには?(ツール)
        - ファイル生書き (Unix らしい管理方法, 高速な開発)
            - いや、よけい難しいかもしれん(w) e.g. sdbとかのたぐい?
        - Berkeley DB    (Unix の伝統は、これ)
            - https://pkg.go.dev/github.com/jsimonetti/berkeleydb
        - Redis (＊これが本命)
            - https://pkg.go.dev/github.com/go-redis/redis
        - どうしても使いたい(SQL が書きたい)なら sqlite でええやん?
            - https://pkg.go.dev/github.com/mattn/go-sqlite3


## サービス内容

- やっぱりサービス名が必要かな?単にPaaSってのもさみしいよね
  (例: heroku ... heroku は語感がイマイチやね。
   なにか北海道っぽい、
   かわいい名前がないもんか?とは思うんですが、なにかありませんかね?
   もはやサービス名で中身が連想できないAWSを見ていると変な名前をつけてはいけないという気もする)
- 申請を受け付けてアカウントを発行(まずは手動でok)
    - 大学在籍者であれば学籍番号など大学のメールアドレス
    - プロジェクト名(任意,英数字のみ)
    - 学外は...よくわかりません (とりあえず、あとで考える)
    - ウエブ申請フォームとか無くてもOK
      (最初のうちは、
       メールで受けつけ紙でパスワードを渡す、もしくはメールかポータルの掲示機能で返す
       (どうせ内輪でしか使ってないから、それでOk))
        - Q: ウエブでユーザ作成する画面を作るコストがサービスに見合ってますか?
- サービス第一号はPaaS
    - 作成したアプリをアップロードすると、そのアプリがインターネットから利用可能になります
        - アプリが`https://${ID}-${APP}.paas.niij.fml.org/`(詳細は以下を参照)で利用可能になる
    - アプリは、それ単体で動くように作成してください。サポート対象の言語は
        1. Go   (x86_64 を指定して作成)
        1. Java (単体で動くように作られたアーカイブ .jar)
        1. その他?(one binary でない言語は、ちょっとね... 他の言語はコンテナを使いなよってね)


## URLの案

- 案といってもURLのパスにユーザ名があらわれる? or Cookie とかで渡すの?くらいしか考えてないけど
    - 本当はサービス名も不要かもしれんが、将来拡張に備えて最初から入れておきましょう

```
https://secure.niij.fml.org/サービス名/
https://secure.niij.fml.org/サービス名/ユーザ名/
```

- ログイン先(サービスのコントロールパネル(通称コンパネ))
```
https://secure.niij.fml.org/paas/
```
- ログインすると表示される階層、アップロード画面(HTMLのFORM)が表示される
```
https://secure.niij.fml.org/paas/b2902900/
```
- アプリをアップロードすると次のようなURLでアクセスできるようになります
```
[例] https://b2902900-appname.paas.niij.fml.org/
```
注:
別途 fml.org のサーバ側で、このDNSの設定を反映させないといけないのですが、
それはbws側では出来ないので、こちら(深町)でやります



## 費用

- 無料


## 運用

- ベストエフォート


## サポート

- ベストエフォート


